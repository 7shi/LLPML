<?xml version="1.0" encoding="utf-8" ?>
<llpml version="0.8.20070926">

<!-- IEEE 754 single precision floating point -->

<include src="finish.xml" />

<call name="printf">-0.1 => </call>
<call name="Float"><int>-1</int><int>-1</int></call>

<call name="printf">3.14159265 => </call>
<call name="Float"><int>314159265</int><int>-8</int></call>

<!-- -->

<int-declare name="INT_MAX">0x7fffffff</int-declare>
<int-declare name="EXP_DIGIT">8</int-declare>
<int-declare name="EXP_MAX">0xff</int-declare>
<int-declare name="SIGN_DIGIT">23</int-declare>
<int-declare name="SIGN_MAX">0x7fffff</int-declare>

<function name="Float">
	<arg name="s" />
	<arg name="e10" />
	<var-declare name="sign">0</var-declare>
	<var-declare name="e2">0</var-declare>
	<var-declare name="ss" />
	<if>
		<cond>
			<equal><var name="s" />0</equal>
		</cond>
		<block>
			<let><var name="e10" />0</let>
		</block>
	</if>
	<if>
		<cond>
			<less><var name="s" />0</less>
		</cond>
		<block>
			<let><var name="sign" />1</let>
			<let>
				<var name="s" />
				<sub>0<var name="s" /></sub>
			</let>
		</block>
	</if>
	<while>
		<cond>
			<equal>
				<mod><var name="s" />10</mod>
				<int>0</int>
			</equal>
		</cond>
		<block>
			<inc><var name="e10" /></inc>
			<var-div><var name="s" />10</var-div>
		</block>
	</while>
	<while>
		<cond>
			<not-equal><var name="e10" />0</not-equal>
		</cond>
		<block>
			<if>
				<cond>
					<less><var name="e10" />0</less>
				</cond>
				<block>
					<dec><var name="e2" /></dec>
					<var-mul><var name="s" />2</var-mul>
					<let>
						<var name="ss" />
						<mod><var name="s" />10</mod>
					</let>
					<if>
						<cond>
							<or>
								<equal><var name="ss" />0</equal>
								<greater>
									<var name="s" />
									<div><int name="INT_MAX" />2</div>
								</greater>
							</or>
						</cond>
						<block>
							<inc><var name="e10" /></inc>
							<var-div><var name="s" />10</var-div>
							<if>
								<cond>
									<greater-equal>
										<var name="ss" />
										<int>5</int>
									</greater-equal>
								</cond>
								<block>
									<inc><var name="s" /></inc>
								</block>
							</if>
						</block>
					</if>
				</block>
				<cond>
					<greater><var name="e10" />0</greater>
				</cond>
				<block>
					<if>
						<cond>
							<and>
								<equal>
									<and><var name="s" />1</and>
									<int>1</int>
								</equal>
								<less-equal>
									<var name="s" />
									<div><int name="INT_MAX" />10</div>
								</less-equal>
							</and>
						</cond>
						<block>
							<dec><var name="e10" /></dec>
							<var-mul><var name="s" />10</var-mul>
						</block>
					</if>
					<inc><var name="e2" /></inc>
					<let>
						<var name="s" />
						<add>
							<div><var name="s" />2</div>
							<and><var name="s" />1</and>
						</add>
					</let>
				</block>
			</if>
		</block>
	</while>
	<while>
		<cond>
			<and>
				<greater><var name="s" />0</greater>
				<less-equal>
					<var name="s" />
					<int name="SIGN_MAX" />
				</less-equal>
			</and>
		</cond>
		<block>
			<dec><var name="e2" /></dec>
			<var-mul><var name="s" />2</var-mul>
		</block>
	</while>
	<while>
		<cond>
			<greater>
				<var name="s" />
				<add>
					<mul><int name="SIGN_MAX" />2</mul>
					<int>1</int>
				</add>
			</greater>
		</cond>
		<block>
			<inc><var name="e2" /></inc>
			<let>
				<var name="s" />
				<add>
					<div><var name="s" />2</div>
					<and><var name="s" />1</and>
				</add>
			</let>
		</block>
	</while>
	<call name="printfln">
		<string>%d-%d-%p</string>
		<var name="sign" />
		<add>
			<var name="e2" />
			<int name="SIGN_DIGIT" />
			<div><int name="EXP_MAX" />2</div>
		</add>
		<and>
			<var name="s" />
			<int name="SIGN_MAX" />
		</and>
	</call>
</function>

</llpml>
