<?xml version="1.0" encoding="utf-8" ?>
<llpml version="0.9.20070930">

<!-- stdio functions -->

<extern name="GetStdHandle" module="kernel32.dll" type="std" />
<extern name="ReadConsole" alias="ReadConsoleW" module="kernel32.dll" type="std" />
<extern name="WriteConsole" alias="WriteConsoleW" module="kernel32.dll" type="std" />
<extern name="lstrlen" alias="lstrlenW" module="kernel32.dll" type="std" />
<extern name="wvsprintf" alias="wvsprintfW" module="user32.dll" type="std" />

<int-declare name="STD_OUTPUT_HANDLE">-11</int-declare>
<int-declare name="STD_INPUT_HANDLE">-10</int-declare>

<var-declare name="stdout">
	<call name="GetStdHandle">
		<int name="STD_OUTPUT_HANDLE" />
	</call>
</var-declare>
<var-declare name="stdin">
	<call name="GetStdHandle">
		<int name="STD_INPUT_HANDLE" />
	</call>
</var-declare>

<function name="print">
	<arg name="text" />
	<var-declare name="dummy" />
	<call name="WriteConsole">
		<var name="stdout" />
		<var name="text" />
		<call name="lstrlen">
			<var name="text" />
		</call>
		<ptr name="dummy" />
		<null />
	</call>
</function>

<function name="vprintf">
	<arg name="format" />
	<arg name="args" />
	<ptr-declare name="buffer" type="char" length="1025" />
	<call name="wvsprintf">
		<ptr name="buffer" />
		<var name="format" />
		<var name="args" />
	</call>
	<call name="print">
		<ptr name="buffer" />
	</call>
</function>

<function name="vprintfln">
	<arg name="format" />
	<arg name="args" />
	<call name="vprintf">
		<var name="format" />
		<var name="args" />
	</call>
	<call name="println" />
</function>

<function name="printf">
	<arg name="format" />
	<arg-ptr name="args" />
	<call name="vprintf">
		<var name="format" />
		<ptr name="args" />
	</call>
</function>

<function name="println">
	<call name="print">"\r\n"</call>
</function>

<function name="printfln">
	<arg name="format" />
	<arg-ptr name="args" />
	<call name="vprintf">
		<var name="format" />
		<ptr name="args" />
	</call>
	<call name="println" />
</function>

<function name="pause">
	<var-declare name="dummy" />
	<ptr-declare name="buffer" type="char" length="16" />
	<call name="ReadConsole">
		<var name="stdin" />
		<ptr name="buffer" />
		<int>2</int>
		<ptr name="dummy" />
		<null />
	</call>
</function>

<function name="finish">
	<call name="println" />
	<call name="printfln">"Press [Enter] to exit."</call>
	<call name="pause" />
</function>

</llpml>
