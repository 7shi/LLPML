<?xml version="1.0" encoding="utf-8" ?>
<llpml version="0.9.20080123">

<!-- stdio functions -->

<extern module="kernel32.dll" type="std" name="GetStdHandle" />
<extern module="kernel32.dll" type="std" name="ReadConsole" alias="ReadConsoleW" />
<extern module="kernel32.dll" type="std" name="WriteConsole" alias="WriteConsoleW" />
<extern module="kernel32.dll" type="std" name="lstrlen" alias="lstrlenW" />
<extern module="user32.dll" type="std" name="wvsprintf" alias="wvsprintfW" />

const int STD_OUTPUT_HANDLE = -11;
const int STD_INPUT_HANDLE  = -10;

var stdout = GetStdHandle(STD_OUTPUT_HANDLE);
var stdin  = GetStdHandle(STD_INPUT_HANDLE);

function print(text)
{
  var dummy;
  WriteConsole(stdout, text, lstrlen(text), addrof(dummy), null);
}

<function name="vprintf">
  <arg name="format" />
  <arg name="args" />
  <ptr-declare name="buffer" type="char" length="1025" />
  wvsprintf(buffer, format, args);
  print(buffer);
</function>

function vprintfln(format, args)
{
  vprintf(format, args);
  println();
}

function printf(format, args : params)
{
  vprintf(format, args);
}

function println()
{
  print("\r\n");
}

function printfln(format, args : params)
{
  vprintf(format, args);
  println();
}

<function name="pause">
  var dummy;
  <ptr-declare name="buffer" type="char" length="16" />
  ReadConsole(stdin, buffer, 2, addrof(dummy));
</function>

</llpml>
