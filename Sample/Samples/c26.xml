<?xml version="1.0" encoding="utf-8" ?>
<llpml version="0.10.20080211">

<!-- heap -->

<include src="finish.xml" />
<include src="malloc.xml" />

<?llp
struct Test
{
  var a = 1;
  
  function ctor() {}
  function dtor() {}
  
  function Show()
  {
    printfln("%p [%s] a = %d", this, __FUNCTION__, a);
  }
}

function Test_new()
{
  //var ret : Test = malloc(sizeof(Test));
  var ret = (Test)malloc(sizeof(Test)); // 型推論
  ret.ctor();
  return ret;
}

function Test_delete(this : Test)
{
  this.dtor();
  free(this);
}

Test test1;
printfln("test1 = %p", test1);
test1.Show();

//var test2 : Test = Test_new();
var test2 = (Test)Test_new(); // 型推論
printfln("test2 = %p", test2);
test2.Show();
test2.a = 2;
test2.Show();
Test_delete(test2);
?>

</llpml>
