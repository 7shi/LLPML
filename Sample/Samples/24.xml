<?xml version="1.0" encoding="utf-8" ?>
<llpml version="0.9.20071021">

<!-- IEEE 754 single precision floating point -->

<include src="finish.xml" />

<call name="printf">"-0.1 => "</call>
<call name="Float">-1, -1</call>

<call name="printf">"3.14159265 => "</call>
<call name="Float">314159265, -8</call>

<!-- -->

<int-declare name="INT_MAX">0x7fffffff</int-declare>
<int-declare name="EXP_DIGIT">8</int-declare>
<int-declare name="EXP_MAX">0xff</int-declare>
<int-declare name="SIGN_DIGIT">23</int-declare>
<int-declare name="SIGN_MAX">0x7fffff</int-declare>

<function name="Float">
	<arg name="s" />
	<arg name="e10" />
	<var-declare name="sign">0</var-declare>
	<var-declare name="e2">0</var-declare>
	<var-declare name="ss" />
	<if>
		<cond>s == 0</cond>
		<block>e10 = 0;</block>
	</if>
	<if>
		<cond>0 > s</cond>
		<block>
			sign = 1;
			s = -s;
		</block>
	</if>
	<while>
		<cond>s % 10 == 0</cond>
		<block>
			e10++;
			s /= 10;
		</block>
	</while>
	<while>
		<cond>e10 != 0</cond>
		<block>
			<if>
				<cond>0 > e10</cond>
				<block>
					e2--;
					s *= 2;
					ss = s % 10;
					<if>
						<cond>ss == 0 || s > INT_MAX / 2</cond>
						<block>
							e10++;
							s /= 10;
							<if>
								<cond>ss >= 5</cond>
								<block>s++;</block>
							</if>
						</block>
					</if>
				</block>
				<cond>e10 > 0</cond>
				<block>
					<if>
						<cond>s and 1 == 1 andalso INT_MAX / 10 >= s</cond>
						<block>
							e10--;
							s *= 10;
						</block>
					</if>
					e2++;
					s = s / 2 + (s and 1);
				</block>
			</if>
		</block>
	</while>
	<while>
		<cond>s > 0 andalso SIGN_MAX >= s</cond>
		<block>
			e2--;
			s *= 2;
		</block>
	</while>
	<while>
		<cond>s > SIGN_MAX * 2 + 1</cond>
		<block>
			e2++;
			s = s / 2 + (s and 1);
		</block>
	</while>
	printfln("%d-%d-%p", sign, e2 + SIGN_DIGIT + EXP_MAX / 2, s and SIGN_MAX);
</function>

</llpml>
