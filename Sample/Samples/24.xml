<?xml version="1.0" encoding="utf-8" ?>
<llpml version="0.9.20080123">

<!-- IEEE 754 single precision floating point -->

<include src="finish.xml" />

printf("-0.1 => ");
Float(-1, -1);

printf("3.14159265 => ");
Float(314159265, -8);

<!-- -->

const int INT_MAX    = 0x7fffffff;
const int EXP_DIGIT  = 8;
const int EXP_MAX    = 0xff;
const int SIGN_DIGIT = 23;
const int SIGN_MAX   = 0x7fffff;

function Float(s, e10)
{
  var sign = 0, e2 = 0, ss;
  if (s == 0) e10 = 0;
  if (0 > s) sign = 1, s = -s;
  while (s % 10 == 0) e10++, s /= 10;
  while (e10 != 0)
  {
    if (0 > e10)
    {
      e2--, s *= 2;
      ss = s % 10;
      if (ss == 0 || s > INT_MAX / 2)
      {
        e10++, s /= 10;
        if (ss >= 5) s++;
      }
    }
    else if (e10 > 0)
    {
      if (s and 1 == 1 andalso INT_MAX / 10 >= s) e10--, s *= 10;
      e2++, s = s / 2 + (s and 1);
    }
  }
  while (s > 0 andalso SIGN_MAX >= s) e2--, s *= 2;
  while (s > SIGN_MAX * 2 + 1) e2++, s = s / 2 + (s and 1);
  printfln("%d-%d-%p", sign, e2 + SIGN_DIGIT + EXP_MAX / 2, s and SIGN_MAX);
}

</llpml>
